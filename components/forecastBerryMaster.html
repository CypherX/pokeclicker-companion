<div class="tab-pane h-100" id="forecastBerryMaster">
    <div class="d-flex flex-column h-100">
        <ul class="nav nav-tabs mb-4" role="tablist" data-bind="foreach: Forecast.berryMasterList">
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" type="button" role="tab"
                    data-bind="text: $data, css: { active: $index() == 0 },
                        attr: { id: `berrymaster-${$index()}-tab`, 'data-bs-target': `#berrymaster-${$index()}`, 'data-path': $data.replace(/\s+/g, '') }"></button>
            </li>
        </ul>
        <div class="tab-content flex-grow-1" style="overflow: auto;" data-bind="foreach: Forecast.berryMasterList">
            <div class="tab-pane" role="tabpanel" data-bind="css: { active: $index() == 0 }, attr: { id: `berrymaster-${$index()}` }">
                <div class="container-xxl" data-bind="if: Forecast.berryMasters().length">

                    <!-- ko ifnot: Companion.data.berryMasterPokemonLocations.includes($index()) -->

                    <!-- ko let: { tradesToShow: ko.observable(3) } -->

                    <div class="alert alert-primary alert-dismissible fade show small">
                        Testing a new UI/UX layout for this page. Provide any feedback in the PokéClicker discord server.
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <div class="control-row mb-2">
                        <div class="row align-items-center">
                            <div class="col-auto">
                                <input class="form-control form-control-sm" type="text" placeholder="Search" data-bind="textInput: Forecast.berryMasterSearchSetting[$index()]">
                            </div>
                            <div class="col-auto">
                                <div class="input-group input-group-sm">
                                    <div class="input-group-text">Display</div>
                                    <select class="form-select form-select-sm"
                                        data-bind="options: [
                                            { name: 'Alphabetical', value: 'alpha' },
                                            { name: 'Next Occurrence', value: 'next' }
                                        ], optionsText: 'name', optionsValue: 'value', value: Forecast.berryMasterDisplaySetting[$index()]">
                                    </select>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="input-group input-group-sm">
                                    <div class="input-group-text">Trades</div>
                                    <select class="form-select form-select-sm"
                                        data-bind="options: Array.from({length: 10}, (_, i) => i + 1), value: tradesToShow">
                                    </select>
                                </div>
                            </div>
                            <!-- ko ifnot: SaveData.isLoaded -->
                            <div class="col-auto ms-auto text-muted small">
                                * Load a save file to see how many trades you can currently afford.
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>

                    <div class="row small" data-bind="foreach: Forecast.getItemListByBerryMaster($index())">
                        <div class="col-12 col-md-6 col-lg-4 mb-3">
                            <div class="card">
                                <div class="card-header text-center" data-bind="text: item"></div>
                                <div class="card-body p-0">
                                    <table class="table table-bordered table-sm mb-0">
                                        <thead>
                                            <tr class="table-dark align-middle">
                                                <th class="text-center">Date</th>
                                                <th class="text-center">Amt</th>
                                                <th class="text-center w-50">Cost</th>
                                                <!-- ko if: SaveData.isLoaded -->
                                                <th class="text-center">Afford</th>
                                                <!-- /ko -->
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: deals.slice(0, tradesToShow())">
                                            <tr class="align-middle">
                                                <td class="text-center" data-bind="text: Util.formatDate(date)"></td>
                                                <td class="text-center" data-bind="text: amount"></td>
                                                <td class="text-center w-50">
                                                    <div class="d-flex flex-wrap justify-content-evenly gap-1" data-bind="foreach: berries">
                                                        <!-- ko if: $index() == 3 -->
                                                        <div class="w-100"></div>
                                                        <!-- /ko -->
                                                        <div class="d-flex flex-column" style="line-height: 1.25;">
                                                            <span data-bind="text: amount"></span>
                                                            <span data-bind="text: BerryType[berryType]"></span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <!-- ko if: SaveData.isLoaded -->
                                                <td class="text-center" data-bind="text: Forecast.calcBerryMasterDealAfford($data.berries).toLocaleString()">0</td>
                                                <!-- /ko -->
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: Companion.data.berryMasterPokemonLocations.includes($index()) -->
                    <div class="row">
                        <div class="col-12 col-md-6 mb-3">
                            <h4 class="mb-2">Current & Upcoming</h4>
                            <div class="table-responsive">
                                <table class="table table-sm small">
                                    <thead>
                                        <tr class="table-dark">
                                            <th>Date</th>
                                            <th>Give</th>
                                            <th>Receive</th>
                                        </tr>
                                    </thead>
                                    <!-- ko foreach: { data: Forecast.getBerryMasterDeals($index(), 7), as: 'date' } -->
                                    <tbody data-bind="foreach: { data: deals, as: 'deal' }">
                                        <!-- ko foreach: { data: deal.berries, as: 'berry' } -->
                                        <tr data-bind="">
                                            <!-- ko if: $parentContext.$index() == 0 && $index() == 0 -->
                                            <td class="align-middle" data-bind="text: Util.formatDate(date.date), attr: { rowspan: date.deals.reduce((sum, d) => sum += d.berries.length, 0) }"></td>
                                            <!-- /ko -->
                                            
                                            <td data-bind="text: `${berry.amount} × ${BerryType[berry.berryType]}`, css: { 'border-bottom-0': $index() < deal.berries.length - 1 }"></td>

                                            <!-- ko if: $index() == 0 -->
                                            <td class="align-middle" data-bind="text: `${$parent.item.amount} × ${$parent.item.itemType._displayName ?? $parent.item.itemType.name}`, attr: { rowspan: deal.berries.length }"></td>
                                            <!-- /ko -->
                                        </tr>
                                        <!-- /ko -->
                                    </tbody>
                                    <!-- /ko -->
                                </table>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div data-bind="with: Forecast.getBerryMasterPokemonMinMaxCost($index())">
                                <h4 class="mb-2">Next Minimum Cost</h4>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover table-striped table-sm small">
                                        <thead>
                                            <tr class="table-dark">
                                                <th>Pokémon</th>
                                                <th class="text-center">Date</th>
                                                <th class="text-center">Cost</th>
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: $data">
                                            <tr>
                                                <td data-bind="text: pokemon"></td>
                                                <td class="text-center" data-bind="text: Util.formatDate(minDate) || '-'"></td>
                                                <td class="text-center" data-bind="text: minCost"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <h4 class="mt-3 mb-2">Next Maximum Cost</h4>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover table-striped table-sm small">
                                        <thead>
                                            <tr class="table-dark">
                                                <th>Pokémon</th>
                                                <th class="text-center">Date</th>
                                                <th class="text-center">Cost</th>
                                            </tr>
                                        </thead>
                                        <tbody data-bind="foreach: $data">
                                            <tr>
                                                <td data-bind="text: pokemon"></td>
                                                <td class="text-center" data-bind="text: Util.formatDate(maxDate) || '-'"></td>
                                                <td class="text-center" data-bind="text: maxCost"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
    </div>
</div>